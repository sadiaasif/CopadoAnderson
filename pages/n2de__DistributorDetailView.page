<apex:page standardController="n2de__Distributor__c" extensions="n2de.DistributorDetailController" sidebar="false">
    <c:CommonHeader />
    <c:TestToolPopup />
    <c:CommonMask />
    <style>
<!-- Replace default header icon -->
img.pageTitleIcon{
    display: none;
}
.content{
    background-image: url({!URLFOR($Resource.DEResources, 'images/distributor32.png')});
    background-repeat: no-repeat;
    background-position-x: 2px;
}
.popup {
    height: 22px !important;
    text-decoration: none;
    padding: 4px 4px !important;
}
.popup:hover {
    text-decoration: none;
    color: #333;
}
.message .messageText a.matchSettingsLink {
    margin: 0;
    font-size: 100%;
}

    </style>
    <script>
$(document).ready(function() {
    $('.picklist_view').each(function() {
        var string = $(this).text();
        $(this).text(string.replace(/;/g , '; '));
    });
    Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.DistributorDetailController.initialisePreviewTestPopUps}',
        '{!distributor.n2de__Team__c}', '{!distributor.Id}',
        function(result, event){
            if (event.type === 'exception'){
                alert(event.message);
            }else{
                if (result != null) {
                    $('.test_distributor').show();
                    if (result.distQueueCounts && result.distQueueCounts.length == 1) {
                        var html = buildAvailableObjectsPopUp(result, result.distQueueCounts[0]);
                        var testHtml = buildTestPopUp(result, result.distQueueCounts[0]);
                        $('#preview_container').html(html);
                        $('#test_container').html(testHtml);
                        $('.tabs').tabs();
                        $('.popup').magnificPopup({
                            type:'inline',
                            midClick: true
                        });
                    }
                }
            }
    });
});

    </script>
    <script defer="defer" src="{!URLFOR($Resource.DEResources, 'scripts/ga.js')}"></script>
    <c:CommonHelp help_page="adding-a-scheduled-distributor" rendered="{!NOT(IsPull) && NOT(IsTrigger)}"/>
    <c:CommonHelp help_page="pull-distributors" rendered="{!IsPull}"/>
    <c:CommonHelp help_page="trigger-distributors" rendered="{!IsTrigger}"/>
    <apex:form >
        <apex:sectionHeader title="{!IF(IsTrigger, 'Trigger', IF(IsPull, 'Pull Distributor', 'Scheduled Distributor'))}" subtitle="{!distributor.Name}"/>
        <apex:pageBlock title="{!IF(IsTrigger, 'Trigger', IF(IsPull, 'Pull Distributor', 'Scheduled Distributor'))} Detail" id="view_block">

            <apex:pageMessages />
            <apex:pageMessage rendered="{!AND(IsClassifierMatchDisabled, ContainsMatchingConfig)}" severity="info" strength="1" escape="false" summary="Please make sure you configure and enable Lead Matching from the {!MatchSettingsLink} page for the matched record functionality to work."/>

            <apex:pageBlockButtons >
                <apex:commandButton action="{!edit}" value="Edit" rendered="{!RecordAccess.HasEditAccess}"/>
                <apex:commandButton action="{!deleteDistributor}" value="Delete" rendered="{!RecordAccess.HasDeleteAccess}" onclick="if (!window.confirm('Are you sure?')) return false;"/>
                <apex:commandButton action="{!cloneDistributor}" value="Clone" rendered="{!RecordAccess.HasEditAccess}" disabled="{!NumberOfDistributors >= MaxDistributorsPerTeam}"/>
                <apex:commandButton id="back_button_top" action="{!backToSummary}" value="Back"/>
                &nbsp;
                <apex:commandButton action="{!startDistributor}" value="Activate {!IF(IsTrigger, 'Trigger', 'Distributor')}" rendered="{!AND(CanActivateDistributor, NOT(Distributor.n2de__Is_active__c))}"/>
                <apex:commandButton action="{!stopDistributor}" value="Deactivate {!IF(IsTrigger, 'Trigger', 'Distributor')}" rendered="{!AND(CanActivateDistributor, Distributor.n2de__Is_active__c)}"/>
                <apex:outputPanel >
                    <apex:outputPanel layout="none" rendered="{!NOT(IsTrigger)}">
                        <a href="#preview-popup-{!distributor.Id}" onclick="initialisePreviewPopUp('{!distributor.Id}')" class="btn popup">Preview Distribution</a>
                    </apex:outputPanel>
                    <a href="#test-popup-{!distributor.Id}" onclick="getTeamMembersAvailability('{!distributor.Id}')" class="btn popup">Test Distributor</a>
                    <div id="preview_container"></div>
                    <div id="test_container"></div>
                </apex:outputPanel>
            </apex:pageBlockButtons>

            <apex:pageBlockSection title="Information" columns="2" collapsible="false">
                <apex:outputField value="{!distributor.Name}"/>
                <apex:outputField value="{!distributor.n2de__Team__c}"/>
                <apex:outputField value="{!distributor.n2de__Is_active__c}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.n2de__Team__c.Fields.n2de__Object_name__c.Label}"/>
                    <apex:outputText value="{!ObjectNameDescription}"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Email_notifications_disabled__c}" rendered="{!NOT(IsPull)}"/>
            </apex:pageBlockSection>

            <apex:pageBlockSection id="distribute_from" title="Distribute from" columns="2" collapsible="false" rendered="{!NOT(IsTrigger)}">
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Queue_id__c.InlineHelpText}" rendered="{!NOT(distributor.n2de__Is_distribute_from_user__c)}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Queue_id__c.Label}"/>
                    <apex:outputText value="{!ObjectQueueName}"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Distribute_from_user__c}" rendered="{!distributor.n2de__Is_distribute_from_user__c}"/>
                <apex:outputField value="{!distributor.n2de__Is_distribute_from_user__c}"/>
            </apex:pageBlockSection>

            <apex:pageBlockSection id="distribution_method" title="Distribution method" rendered="{!NOT(IsTrigger)}" collapsible="false">
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Algorithm__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Algorithm__c.Label}"/>
                    <apex:outputText id="algorithm_label" value="{!AlgorithmLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_respect_distribution_hours__c.InlineHelpText}" rendered="{!IsPull}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_respect_distribution_hours__c.Label}"/>
                    <apex:outputField value="{!distributor.n2de__Is_respect_distribution_hours__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!RoundRobinScopeVisible}">
                    <apex:outputLabel value="Round Robin scope"/>
                    <apex:outputPanel >
                        <apex:outputText id="round_robin_scope_label" value="{!RoundRobinScope}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="When checked, round robin will not be performed when a lookup owner match or sticky assignment is not found." rendered="{!OR(AND(distributor.n2de__Algorithm__c=='Round robin lookup owner', NOT(distributor.n2de__Is_round_robin_disabled__c)), distributor.n2de__Algorithm__c=='Round robin sticky assignment')}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_round_robin_disabled__c.Label}"/>
                    <apex:outputField value="{!distributor.n2de__Is_round_robin_disabled__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_weighting_enabled__c.InlineHelpText}" rendered="{!AND(distributor.n2de__Algorithm__c!='Round robin lookup owner', NOT(distributor.n2de__Is_round_robin_disabled__c), distributor.n2de__Algorithm__c != 'Related owner', NOT(IsPull))}">
                    <apex:outputLabel value="Weighting enabled"/>
                    <apex:outputField value="{!distributor.n2de__Is_weighting_enabled__c}" styleClass="rr_disabled"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="This is a team-wide setting - it can be edited in the team detail" rendered="{!IsLoadBalancingAlgorithm}">
                    <apex:outputLabel value="Load balancing duration"/>
                    <apex:outputText value="{!LoadBalanceDuration}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!IsDisplayLoadBalancingDurationMessage}"/>
                <apex:pageBlockSectionItem rendered="{!IsDisplayLoadBalancingDurationMessage}">
                    <apex:outputLabel value=""/>
                    <apex:outputText value="{!LoadBalanceDurationMessage}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Load_balancing_level__c.InlineHelpText}" rendered="{!AND(IsLoadBalancingAlgorithm, NOT(IsLoadBalancingDurationActiveCount))}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Load_balancing_level__c.Label}"/>
                    <apex:outputField value="{!distributor.n2de__Load_balancing_level__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Load_balancing_level__c.InlineHelpText}" rendered="{!AND(IsLoadBalancingAlgorithm, IsLoadBalancingDurationActiveCount)}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Load_balancing_level__c.Label}"/>
                    <apex:outputText value="{!LoadBalanceLevelTeam}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="2" rendered="{!AND(OR(distributor.n2de__Algorithm__c=='Round robin sticky assignment', distributor.n2de__Algorithm__c=='Load balancing sticky assignment'), NOT(IsTrigger))}">
                <!-- Sticky assignment fields -->
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Sticky_assignment_id_field_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Sticky_assignment_id_field_name__c.Label}"/>
                    <apex:outputText value="{!stickyAssignmentIdFieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_stick_on_OOO__c.InlineHelpText}">
                    <apex:outputLabel value="Retain sticky when user is unavailable"/>
                    <apex:outputField value="{!distributor.n2de__Is_stick_on_OOO__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Sticky_period__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Sticky_period__c.Label}"/>
                    <apex:outputPanel styleClass="requiredIndicator">
                        <apex:outputField value="{!distributor.n2de__Sticky_period__c}"/>
                        &nbsp;
                        <apex:outputField value="{!distributor.n2de__Sticky_unit__c}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Remove_sticky_on_rejection__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Remove_sticky_on_rejection__c.Label}"/>
                    <apex:outputText value="{!distributor.n2de__Remove_sticky_on_rejection__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_stick_on_widget_off__c.InlineHelpText}" rendered="{!UserLoginModeEnabled}">
                    <apex:outputLabel value="Retain sticky when user toggled off in widget"/>
                    <apex:outputField value="{!distributor.n2de__Is_stick_on_widget_off__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(UserLoginModeEnabled)}"/>
                <apex:outputField value="{!distributor.n2de__Sticky_match_level__c}"/>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <!-- End of sticky assignment fields -->
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="2" rendered="{!AND(distributor.n2de__Algorithm__c=='Round robin lookup owner', NOT(IsTrigger))}">
                <!-- Lookup owner fields -->
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Lookup to"/>
                    <apex:outputText value="{!lookupObjectLabel}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem helpText="When checked, lookup owner will still be assigned when a team member is out of office or outside working hours.">
                    <apex:outputLabel value="Assign if user is unavailable"/>
                    <apex:outputField value="{!distributor.n2de__Is_stick_on_OOO__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!UserLoginModeEnabled}"/>
                <apex:pageBlockSectionItem helpText="When checked, lookup owner will still be assigned if a team member is toggled off in the widget, but within working hours." rendered="{!UserLoginModeEnabled}">
                    <apex:outputLabel value="Assign if user toggled off in widget"/>
                    <apex:outputField value="{!distributor.n2de__Is_stick_on_widget_off__c}"/>
                </apex:pageBlockSectionItem>

                <apex:outputPanel layout="block" style="float: right;">
                    <apex:pageBlockSection columns="2">
                        <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_unique_id_field_name__c.InlineHelpText}">
                            <apex:outputLabel value="{!ObjectNameDescription} field" style="display: inline-block; width: 75px"/>
                            <apex:outputText value="{!lookupUniqueIdFieldLabel}"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_match_field_name__c.InlineHelpText}">
                            <apex:outputLabel value="{!lookupObjectLabel} field" style="display: inline-block; width: 75px"/>
                            <apex:outputText value="{!lookupMatchFieldLabel}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(lookupUniqueIdFieldLabel2 != '', lookupUniqueIdFieldLabel2 != null)}">
                            <apex:outputText value="OR" style="font-size: 90%; font-weight: bold"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem rendered="{!AND(lookupUniqueIdFieldLabel2 != '', lookupUniqueIdFieldLabel2 != null)}"/>

                        <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_unique_id_field_name__c.InlineHelpText}" rendered="{!AND(lookupUniqueIdFieldLabel2 != '', lookupUniqueIdFieldLabel2 != null)}">
                            <apex:outputLabel value="{!ObjectNameDescription} field"/>
                            <apex:outputText value="{!lookupUniqueIdFieldLabel2}"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_match_field_name__c.InlineHelpText}" rendered="{!AND(lookupUniqueIdFieldLabel2 != '', lookupUniqueIdFieldLabel2 != null)}">
                            <apex:outputLabel value="{!lookupObjectLabel} field"/>
                            <apex:outputText value="{!lookupMatchFieldLabel2}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(lookupUniqueIdFieldLabel3 != '', lookupUniqueIdFieldLabel3 != null)}">
                            <apex:outputText value="OR" style="font-size: 90%; font-weight: bold"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem rendered="{!AND(lookupUniqueIdFieldLabel3 != '', lookupUniqueIdFieldLabel3 != null)}"/>

                        <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_unique_id_field_name__c.InlineHelpText}" rendered="{!AND(lookupUniqueIdFieldLabel3 != '', lookupUniqueIdFieldLabel3 != null)}">
                            <apex:outputLabel value="{!ObjectNameDescription} field"/>
                            <apex:outputText value="{!lookupUniqueIdFieldLabel3}"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_match_field_name__c.InlineHelpText}" rendered="{!AND(lookupUniqueIdFieldLabel3 != '', lookupUniqueIdFieldLabel3 != null)}">
                            <apex:outputLabel value="{!lookupObjectLabel} field"/>
                            <apex:outputText value="{!lookupMatchFieldLabel3}"/>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                </apex:outputPanel>
                <apex:pageBlockSectionItem />

                <apex:pageBlockSectionItem helpText="Only match on records that fulfil this condition (optional)" rendered="{!lookupFilterFieldLabel != ''}">
                    <apex:outputLabel value="Where"/>
                    <apex:outputPanel layout="block">
                        <apex:outputLabel value="{!lookupObjectLabel}.{!lookupFilterFieldLabel}"/>&nbsp;
                        <apex:outputLabel styleClass="filterOperator" value="{!distributor.n2de__Lookup_filter_operator__c}"/>&nbsp;
                        <apex:outputLabel styleClass="picklist_view" value="{!distributor.n2de__Lookup_filter_value_long__c}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!lookupFilterFieldLabel != ''}"/>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_owner_field_name__c.InlineHelpText}">
                    <apex:outputLabel value="Assign to {!lookupObjectLabel} field"/>
                    <apex:outputText value="{!lookupObjectLabel}.{!lookupOwnerFieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
                <!-- End of lookup owner assignment fields -->
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="2" rendered="{!AND(distributor.n2de__Algorithm__c == 'Related owner', NOT(IsTrigger))}">
                <!-- Related owner fields -->
                <apex:pageBlockSectionItem helpText="Which related record to check whether it exists first">
                    <apex:outputLabel value="Assign using related object"/>
                    <apex:outputText value="{!RelatedOwnerObject1Label}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem helpText="When checked, related owner will still be assigned when a team member is out of office or outside working hours.">
                    <apex:outputLabel value="Assign if user is unavailable"/>
                    <apex:outputField value="{!distributor.n2de__Is_stick_on_OOO__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem helpText="The field to use to get the id of the user to assign the record to">
                    <apex:outputLabel value="Using {!RelatedOwnerObject1Type} field"/>
                    <apex:outputText value="{!RelatedOwnerObject1FieldLabel}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!UserLoginModeEnabled}" helpText="When checked, related owner will still be assigned if a team member is toggled off in the widget, but within working hours.">
                    <apex:outputLabel value="Assign if user toggled off in widget"/>
                    <apex:outputField value="{!distributor.n2de__Is_stick_on_widget_off__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(UserLoginModeEnabled)}"/>

                <apex:pageBlockSectionItem rendered="{!NOT(ISBLANK(RelatedOwnerObject2Label))}" helpText="Which related record to check whether it exists next" labelStyle="padding-top: 15px;" dataStyle="padding-top: 15px;">
                    <apex:outputLabel value="Otherwise use related object"/>
                    <apex:outputText value="{!RelatedOwnerObject2Label}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(ISBLANK(RelatedOwnerObject2Label))}"/>

                <apex:pageBlockSectionItem rendered="{!NOT(ISBLANK(RelatedOwnerObject2Label))}" helpText="The field to use to get the id of the user to assign the record to">
                    <apex:outputLabel value="Using {!RelatedOwnerObject2Type} field"/>
                    <apex:outputText value="{!RelatedOwnerObject2FieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(ISBLANK(RelatedOwnerObject2Label))}"/>
                <!-- End of related owner fields -->
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="2" title="Distribution settings" rendered="{!NOT(IsTrigger)}" collapsible="false">
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Distribution_control__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Distribution_control__c.Label}"/>
                    <apex:outputText value="{!DistributionControlLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!distributor.n2de__Distribution_control__c=='None'}"/>
                <apex:pageBlockSectionItem helpText="{!DistributionControlHelpText}" rendered="{!distributor.n2de__Distribution_control__c!='None'}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.fields.n2de__Distribution_control_member_cap__c.Label}"/>
                    <apex:outputText value="{!distributor.n2de__Distribution_control_member_cap__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!DistributionControlMessage != null}">
                    <apex:outputLabel value=""/>
                    <apex:outputText value="{!DistributionControlMessage}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!DistributionControlMessage != null}"/>

                <apex:outputField value="{!distributor.n2de__Ignore_team_level_caps__c}" rendered="{!TeamLevelCapsEnabled}"/>
                <apex:pageBlockSectionItem rendered="{!TeamLevelCapsEnabled}"/>

                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Field_to_update_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Field_to_update_name__c.Label}"/>
                    <apex:outputText value="{!IF(Distributor.n2de__Field_to_update_name__c=null, '-- none --', fieldToUpdateLabel)}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Field_to_update_value__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Field_to_update_value__c.Label}"/>
                    <apex:outputPanel layout="none">
                        <apex:outputText value="{!distributor.n2de__Field_to_update_value__c}" rendered="{!distributor.n2de__Field_to_update_type__c != 'BOOLEAN'}"/>
                        <apex:outputPanel rendered="{!distributor.n2de__Field_to_update_type__c == 'BOOLEAN'}">
                            <img src="/img/checkbox_{!IF(distributor.n2de__Field_to_update_value__c == 'true', '', 'un')}checked.gif"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Execution_order__c}" rendered="{!NOT(IsPull)}"/>
            </apex:pageBlockSection>

            <apex:pageBlockSection id="trigger_method" title="Distribution method" columns="2" collapsible="false" rendered="{!IsTrigger}">
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Algorithm__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Algorithm__c.Label}"/>
                    <apex:outputText id="trigger_algorithm" value="{!AlgorithmLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!RoundRobinScopeVisible}">
                    <apex:outputLabel value="Round Robin scope"/>
                    <apex:outputPanel >
                        <apex:outputText id="trigger_round_robin_scope_label" value="{!RoundRobinScope}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_round_robin_disabled__c.InlineHelpText}" rendered="{!OR(AND(distributor.n2de__Algorithm__c=='Round robin lookup owner', NOT(distributor.n2de__Is_round_robin_disabled__c)), distributor.n2de__Algorithm__c=='Round robin sticky assignment')}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_round_robin_disabled__c.Label}"/>
                    <apex:outputField value="{!distributor.n2de__Is_round_robin_disabled__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_weighting_enabled__c.InlineHelpText}" rendered="{!OR(distributor.n2de__Algorithm__c='Load balancing', distributor.n2de__Algorithm__c=='Round robin sticky assignment', distributor.n2de__Algorithm__c=='Round robin')}">
                    <apex:outputLabel value="Weighting enabled"/>
                    <apex:outputField value="{!distributor.n2de__Is_weighting_enabled__c}" styleClass="rr_disabled"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="This is a team-wide setting - it can be edited in the team detail" rendered="{!IsLoadBalancingAlgorithm}">
                    <apex:outputLabel value="Load balancing duration"/>
                    <apex:outputText value="{!LoadBalanceDuration}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Load_balancing_level__c.InlineHelpText}" rendered="{!AND(IsLoadBalancingAlgorithm, NOT(IsLoadBalancingDurationActiveCount))}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Load_balancing_level__c.Label}"/>
                    <apex:outputField value="{!distributor.n2de__Load_balancing_level__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Load_balancing_level__c.InlineHelpText}" rendered="{!AND(IsLoadBalancingAlgorithm, IsLoadBalancingDurationActiveCount)}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Load_balancing_level__c.Label}"/>
                    <apex:outputText value="{!LoadBalanceLevelTeam}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="1" rendered="{!AND(distributor.n2de__Algorithm__c=='Dynamic owner', IsTrigger)}">
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Dynamic_owner_field_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Dynamic_owner_field_name__c.Label}"/>
                    <apex:outputText value="{!IF(Distributor.n2de__Dynamic_owner_field_name__c=null, '-- none --', dynamicOwnerFieldLabel)}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="2" rendered="{!AND(distributor.n2de__Algorithm__c=='Round robin sticky assignment', IsTrigger)}">
                <!-- Sticky assignment fields -->
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Sticky_assignment_id_field_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Sticky_assignment_id_field_name__c.Label}"/>
                    <apex:outputText value="{!stickyAssignmentIdFieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_stick_on_OOO__c.InlineHelpText}">
                    <apex:outputLabel value="Retain sticky when user is unavailable"/>
                    <apex:outputField value="{!distributor.n2de__Is_stick_on_OOO__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Sticky_period__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Sticky_period__c.Label}"/>
                    <apex:outputPanel styleClass="requiredIndicator">
                        <apex:outputField value="{!distributor.n2de__Sticky_period__c}"/>
                        &nbsp;
                        <apex:outputField value="{!distributor.n2de__Sticky_unit__c}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_stick_on_widget_off__c.InlineHelpText}" rendered="{!UserLoginModeEnabled}">
                    <apex:outputLabel value="Retain sticky when user toggled off in widget"/>
                    <apex:outputField value="{!distributor.n2de__Is_stick_on_widget_off__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(UserLoginModeEnabled)}"/>
                <apex:outputField value="{!distributor.n2de__Sticky_match_level__c}"/>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <!-- End of sticky assignment fields -->
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="1" rendered="{!AND(distributor.n2de__Algorithm__c=='Round robin lookup owner', IsTrigger)}">
                <!-- Lookup owner fields -->
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_unique_id_field_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!ObjectNameDescription} lookup field"/>
                    <apex:outputText value="{!lookupUniqueIdFieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_object_name__c.InlineHelpText}">
                    <apex:outputLabel value="Lookup to"/>
                    <apex:outputPanel >
                        <apex:outputText value="{!lookupObjectLabel}.{!lookupMatchFieldLabel}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Where"/>
                    <apex:outputPanel layout="block" rendered="{!lookupFilterFieldLabel != ''}">
                        <apex:outputLabel value="{!lookupObjectLabel}.{!lookupFilterFieldLabel}"/>&nbsp;
                        <apex:outputLabel styleClass="filterOperator" value="{!distributor.n2de__Lookup_filter_operator__c}"/>&nbsp;
                        <apex:outputLabel styleClass="picklist_view" value="{!distributor.n2de__Lookup_filter_value_long__c}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Lookup_owner_field_name__c.InlineHelpText}">
                    <apex:outputLabel value="Assign to {!lookupObjectLabel} field"/>
                    <apex:outputText value="{!lookupObjectLabel}.{!lookupOwnerFieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
                <!-- End of lookup owner assignment fields -->
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="2" title="Distribution settings" rendered="{!IsTrigger}" collapsible="false">
                <apex:outputField id="trigger_distribution_control" value="{!distributor.n2de__Distribution_control__c}" rendered="{!Distributor.n2de__Algorithm__c != 'Load balancing'}"/>
                <apex:pageBlockSectionItem rendered="{!AND(Distributor.n2de__Algorithm__c != 'Load balancing', distributor.n2de__Distribution_control__c=='None')}"/>
                <apex:outputField id="trigger_distributor_control_member_cap" value="{!distributor.n2de__Distribution_control_member_cap__c}" rendered="{!distributor.n2de__Distribution_control__c!='None'}"/>
                <apex:outputField id="trigger_ignore_team_level_caps" value="{!distributor.n2de__Ignore_team_level_caps__c}" rendered="{!AND(Distributor.n2de__Algorithm__c != 'Load balancing', TeamLevelCapsEnabled)}"/>
                <apex:pageBlockSectionItem rendered="{!AND(Distributor.n2de__Algorithm__c != 'Load balancing', TeamLevelCapsEnabled)}"/>
                <apex:pageBlockSectionItem rendered="{!Distributor.n2de__Algorithm__c != 'Load balancing'}"/>
                <apex:pageBlockSectionItem rendered="{!Distributor.n2de__Algorithm__c != 'Load balancing'}"/>

                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Field_to_update_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Field_to_update_name__c.Label}"/>
                    <apex:outputText value="{!IF(Distributor.n2de__Field_to_update_name__c=null, '-- none --', fieldToUpdateLabel)}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Field_to_update_value__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Field_to_update_value__c.Label}"/>
                    <apex:outputPanel layout="none">
                        <apex:outputText value="{!distributor.n2de__Field_to_update_value__c}" rendered="{!distributor.n2de__Field_to_update_type__c != 'BOOLEAN'}"/>
                        <apex:outputPanel rendered="{!distributor.n2de__Field_to_update_type__c == 'BOOLEAN'}">
                            <img src="/img/checkbox_{!IF(distributor.n2de__Field_to_update_value__c == 'true', '', 'un')}checked.gif"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:outputField id="trigger_default_owner_type" value="{!distributor.n2de__Default_owner_type__c}"/>
                <apex:outputField id="trigger_default_owner_user" value="{!distributor.n2de__Default_owner_user__c}" rendered="{!distributor.n2de__Default_owner_type__c=='User'}"/>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Default_owner_queue_id__c.InlineHelpText}" rendered="{!distributor.n2de__Default_owner_type__c=='Queue'}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Default_owner_queue_id__c.Label}"/>
                    <apex:outputText id="trigger_default_owner_queue" value="{!DefaultOwnerQueueName}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!IsCurrentOwnerTrigger}"/>
                <apex:pageBlockSectionItem helpText="Current owner trigger ignores team member's availability and assigns even if a team member is out of office, out of the distribution hours or on holiday." rendered="{!IsCurrentOwnerTrigger}">
                    <apex:outputLabel value="Log current owner when user is unavailable"/>
                    <apex:outputText id="trigger_log_when_user_unavailable" value="yes"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="Current owner trigger makes an assignment even if a team member is logged out of the widget." rendered="{!IsCurrentOwnerTrigger}">
                    <apex:outputLabel value="Log current owner when user is toggled off in widget"/>
                    <apex:outputText id="trigger_log_when_user_offline" value="yes"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Execution_order__c}"/>
            </apex:pageBlockSection>

            <apex:pageBlockSection id="distribution_order" title="Queue order" columns="2" collapsible="false" rendered="{!NOT(IsTrigger)}">
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Order_1_field_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Order_1_field_name__c.Label}"/>
                    <apex:outputText value="{!order1FieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Order_1_order_by__c}"/>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Order_2_field_name__c.InlineHelpText}" rendered="{!distributor.n2de__Order_2_field_name__c!=''}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Order_2_field_name__c.Label}"/>
                    <apex:outputText value="{!order2FieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Order_2_order_by__c}" rendered="{!distributor.n2de__Order_2_field_name__c!=''}"/>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Order_3_field_name__c.InlineHelpText}" rendered="{!distributor.n2de__Order_3_field_name__c!=''}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Order_3_field_name__c.Label}"/>
                    <apex:outputText value="{!order3FieldLabel}"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Order_3_order_by__c}" rendered="{!distributor.n2de__Order_3_field_name__c!=''}"/>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="{!ObjectNameDescription} filter" columns="2" collapsible="false">
                <apex:pageBlockSectionItem />
                <c:CommonInlineHelp help_page="filters"/>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_distributor_category__c.InlineHelpText}">
                    <apex:outputLabel value="{!IF(ObjectName=='Lead', 'Filter by fields', 'Filter enabled')}"/>
                    <apex:outputField value="{!distributor.n2de__Is_distributor_category__c}"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!Distributor.n2de__Is_advanced_filter__c}" rendered="{!AND(Distributor.n2de__Is_distributor_category__c, NOT(IsTrigger), OR(AdvancedFiltersEnabled, Distributor.n2de__Is_advanced_filter__c))}"/>
            </apex:pageBlockSection>
            <apex:pageBlockSection id="distributor_category" columns="1" collapsible="false">
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor_category__c.Fields.n2de__Filter_field_name__c.InlineHelpText}" rendered="{!AND(Distributor.n2de__Is_distributor_category__c, NOT(Distributor.n2de__Is_advanced_filter__c))}">
                    <apex:outputLabel value="Filter rows"/>
                    <apex:outputPanel id="filter_panel">
                        <apex:dataTable value="{!DistributionFilterVOList}" var="filter" headerClass="tableHeader">
                            <apex:column styleClass="filterSeq">
                                <apex:outputText value="{!filter.FilterSeq}." styleClass="label"/>
                            </apex:column>
                            <apex:column styleClass="filterField">
                                <apex:facet name="header">Field</apex:facet>
                                <apex:outputText value="{!filter.filterFieldLabel}"/>
                            </apex:column>
                            <apex:column styleClass="filterOperator">
                                <apex:facet name="header">Operator&nbsp;</apex:facet>
                                <apex:outputField value="{!filter.DistributorCategory.n2de__Filter_comparison_operator__c}"/>
                            </apex:column>
                            <apex:column styleClass="filterValue picklist_view">
                                <apex:facet name="header">Value</apex:facet>
                                <apex:outputText rendered="{!AND(filter.DistributorCategory.n2de__Filter_field_type__c != 'DATE', filter.DistributorCategory.n2de__Filter_field_type__c != 'DATETIME')}" value="{!IF(filter.DistributorCategory.n2de__Filter_field_name__c=='RecordTypeId', filter.CategoryFilterFieldRecordTypeName, filter.DistributorCategory.n2de__Filter_comparison_argument_long__c )}"/>
                                <apex:outputText rendered="{!OR(filter.DistributorCategory.n2de__Filter_field_type__c == 'DATE', filter.DistributorCategory.n2de__Filter_field_type__c == 'DATETIME')}" value="{!filter.filterValue}"/>
                            </apex:column>
                        </apex:dataTable>
                        <br/>
                        <apex:outputPanel rendered="{!Distributor.n2de__Is_filter_logic__c}">
                            <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Filter_logic__c.Label}: " styleClass="label"/>
                            <apex:outputField value="{!Distributor.n2de__Filter_logic__c}"/>
                        </apex:outputPanel>
                        <br/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!Distributor.n2de__Filter_soql_string__c}" rendered="{!AND(Distributor.n2de__Is_distributor_category__c, Distributor.n2de__Is_advanced_filter__c)}"/>
            </apex:pageBlockSection>
            <apex:pageBlockSection rendered="{!CanFilterByCampaign}" columns="1">
                <apex:outputField value="{!Distributor.n2de__Filter_by_campaign__c}"/>
                <apex:pageBlockSectionItem rendered="{!Distributor.n2de__Filter_by_campaign__c}">
                    <apex:outputLabel value="Campaigns"/>
                    <apex:outputText value="{!CampaignNameString}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="1" collapsible="false" title="Team member filter" rendered="{!DistributorSupportsTeamMemberFilter}">
                <c:CommonInlineHelp help_page="team-member-filters"/>
                <apex:outputField value="{!Distributor.n2de__Is_member_filter__c}"/>
                <apex:outputField value="{!Distributor.n2de__Member_filter_type__c}" rendered="{!Distributor.n2de__Is_member_filter__c}"/>
                <apex:pageBlockSectionItem helpText="Selected team members this distributor will distribute to." rendered="{!AND(distributor.n2de__Member_filter_type__c=='Team members', NOT(distributor.n2de__Is_all_members__c))}">
                    <apex:outputLabel value="Selected team members"/>
                    <apex:outputPanel >
                        <apex:outputPanel rendered="{!CategoryFilterTeamMemberList.size > 0}">
                            <apex:dataTable value="{!CategoryFilterTeamMemberList}" var="ML" headerClass="pbTableHeader">
                                <apex:column >
                                    <apex:outputLink value="/{!ML.DistributorCategoryTeamMember.n2de__Distribution_team_member__c}">{!IF(ML.DistributorCategoryTeamMember.Distribution_team_member__r.n2de__Queue_id__c=null, ML.DistributorCategoryTeamMember.Distribution_team_member__r.User__r.Name, ML.QueueName)}</apex:outputLink>
                                </apex:column>
                            </apex:dataTable>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!CategoryFilterTeamMemberList.size == 0}">
                            <apex:outputLabel style="font-weight: bold; color: red;" value="No active team members selected for this distributor"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="Selected team members this distributor will distribute to." rendered="{!AND(distributor.n2de__Is_member_filter__c, distributor.n2de__Member_filter_type__c=='Team members', distributor.n2de__Is_all_members__c)}">
                    <apex:outputLabel value="Selected team members"/>
                    <apex:outputText value="--All team members--"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor_category__c.Fields.n2de__Filter_field_name__c.InlineHelpText}" rendered="{!AND(Distributor.n2de__Is_member_filter__c, Distributor.n2de__Member_filter_type__c=='Tags')}">
                    <apex:outputLabel value="Filter rows"/>
                    <apex:outputPanel id="filter_panel">
                        <apex:dataTable value="{!distributorTagList}" var="tag" headerClass="tableHeader">
                            <apex:column id="filterSeq" styleClass="filterSeq">
                                <apex:outputText value="{!tag.Sequence}." styleClass="label"/>
                            </apex:column>
                            <apex:column id="filterType" styleClass="filterType">
                                <apex:facet name="header">Type</apex:facet>
                                <apex:outputText value="{!tag.Type}"/>
                            </apex:column>
                            <apex:column id="filterTag" styleClass="filterTag">
                                <apex:facet name="header">Collection</apex:facet>
                                <apex:outputText value="{!tag.DistributorTagCategoryName}"/>
                            </apex:column>
                            <apex:column id="filterOperator" styleClass="filterOperator">
                                <apex:facet name="header">Operator</apex:facet>
                                <apex:outputText value="{!tag.ComparisonOperator}"/>
                            </apex:column>
                            <apex:column id="filterValue" styleClass="filterValue picklist_view">
                                <apex:facet name="header">Tags</apex:facet>
                                <apex:outputPanel id="tagValue">
                                    <apex:outputText value="{!tag.DistributorTagValues}" rendered="{!tag.Type == 'Static'}"/>
                                    <apex:outputText value="{!tag.FieldLabel}" rendered="{!tag.Type == 'Dynamic'}"/>
                                </apex:outputPanel>
                            </apex:column>
                        </apex:dataTable>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="SLAs" columns="1" collapsible="false" rendered="{!TeamHasAlerts}">
                <apex:pageBlockSectionItem helpText="When checked, any SLAs that have been specified for the team will be active for this distributor. Uncheck to disable for this distributor.">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_alert__c.Label}"/>
                    <apex:outputField value="{!distributor.n2de__Is_alert__c}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Auto re-assign" columns="1" collapsible="false" rendered="{!TeamHasAlerts}">
                <apex:pageBlockSectionItem helpText="When checked object records will be re-assigned to a specified queue or user when the distribution of that record hits an SLA.">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Is_auto_reassign__c.Label}"/>
                    <apex:outputField value="{!distributor.n2de__Is_auto_reassign__c}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="2" rendered="{!distributor.n2de__Is_auto_reassign__c}">
                <apex:pageBlockSectionItem helpText="Number of the first SLA on which to re-assign the record. Reassignment will occur on this or the first subsequent SLA to be hit.">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reassign_on_alert_sequence__c.Label}"/>
                    <apex:outputField value="{!distributor.n2de__Reassign_on_alert_sequence__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reassign_queue_id__c.InlineHelpText}" rendered="{!NOT(distributor.n2de__Is_reassign_to_user__c)}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reassign_queue_id__c.Label}"/>
                    <apex:outputText value="{!ReassignQueueName}"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Reassign_to_user__c}" rendered="{!distributor.n2de__Is_reassign_to_user__c}"/>
                <apex:outputField value="{!distributor.n2de__Is_reassign_to_user__c}"/>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reassign_field_to_update_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reassign_field_to_update_name__c.Label}"/>
                    <apex:outputText value="{!IF(Distributor.n2de__Reassign_field_to_update_name__c=null, '-- none --', reassignFieldToUpdateLabel)}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reassign_field_to_update_value__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reassign_field_to_update_value__c.Label}"/>
                    <apex:outputPanel layout="none">
                        <apex:outputText value="{!distributor.n2de__Reassign_field_to_update_value__c}" rendered="{!distributor.n2de__Reassign_field_to_update_type__c != 'BOOLEAN'}"/>
                        <apex:outputPanel rendered="{!distributor.n2de__Reassign_field_to_update_type__c == 'BOOLEAN'}">
                            <img src="/img/checkbox_{!IF(distributor.n2de__Reassign_field_to_update_value__c == 'true', '', 'un')}checked.gif"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="When checked, user will be toggled off from DE on auto re-assign" rendered="{!UserLoginModeEnabled}">
                    <apex:outputLabel value="Toggle user off"/>
                    <apex:image url="/img/checkbox_{!IF(LogoutUserOnReassign, '', 'un')}checked.gif"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="Assignment Rejection" columns="2" collapsible="false" rendered="{!RejectionEnabled}">
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reject_queue_id__c.InlineHelpText}" rendered="{!NOT(distributor.n2de__Is_reject_to_user__c)}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reject_queue_id__c.Label}"/>
                    <apex:outputText value="{!RejectQueueName}"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!distributor.n2de__Reject_to_user__c}" rendered="{!distributor.n2de__Is_reject_to_user__c}"/>
                <apex:outputField value="{!distributor.n2de__Is_reject_to_user__c}"/>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reject_field_to_update_name__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reject_field_to_update_name__c.Label}"/>
                    <apex:outputText value="{!IF(Distributor.n2de__Reject_field_to_update_name__c=null, '-- none --', rejectFieldToUpdateLabel)}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reject_field_to_update_value__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Reject_field_to_update_value__c.Label}"/>
                    <apex:outputPanel layout="none">
                        <apex:outputText value="{!distributor.n2de__Reject_field_to_update_value__c}" rendered="{!distributor.n2de__Reject_field_to_update_type__c != 'BOOLEAN'}"/>
                        <apex:outputPanel rendered="{!distributor.n2de__Reject_field_to_update_type__c == 'BOOLEAN'}">
                            <img src="/img/checkbox_{!IF(distributor.n2de__Reject_field_to_update_value__c == 'true', '', 'un')}checked.gif"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Replace_rejected_assignment__c.InlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.n2de__Distributor__c.Fields.n2de__Replace_rejected_assignment__c.Label}"/>
                    <apex:outputField id="replace_rejected_assignment" value="{!distributor.n2de__Replace_rejected_assignment__c}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="History" columns="2" collapsible="false">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Created By" for="created_by"/>
                    <apex:outputPanel >
                        <apex:outputField id="created_by" value="{!distributor.CreatedById}"/>
                        ,&nbsp;
                        <apex:outputField value="{!distributor.CreatedDate}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Modified By"/>
                    <apex:outputPanel >
                        <apex:outputField value="{!distributor.LastModifiedById}"/>
                        ,&nbsp;
                        <apex:outputField value="{!distributor.LastModifiedDate}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
        </apex:pageBlock>
        <c:HistoryTable historyList="{!latestHistory}" blockTitle="Distributor History" sectionTitle="Distributor Change History"/>

    </apex:form>

    <style>
        .pbTableHeader {
            display: none;
        }
        .tableHeader {
            font-size: 11px;
            color: #4A4A56;
        }
        .filterSeq {
            width: 20px;
        }
        .filterField {
            padding-right: 20px;
        }
        .filterOperator {
            padding-right: 30px;
            font-size: 80%;
            text-transform: uppercase;
        }
        .filterValue {
            padding-right: 20px;
        }
        .filterType {
            padding-right: 20px;
        }
        .filterTag {
            padding-right: 20px;
        }
        .label {
            font-weight: bold;
            color: #4A4A56;
        }

    </style>
    <c:StatusPanel />
</apex:page>